---
title: エビデンスサポートツール 仕様書
version: 1.0.0
date: 2025-10-16
---

# 1. 概要

エビデンスサポートツールは、指定したログファイルから対象部分のログエントリを抽出し、新しく追加されたログエントリを特定して出力することで、ユーザーが特定の作業やプロセスを証明するためのエビデンス（証拠）収集を支援するアプリケーションです。

# 2. 機能要件

## 2.1. ログエントリ抽出機能

- 指定したログファイルから対象部分のログエントリだけを取得します。
- 開始時と停止時にログファイルを比較することで、新しく追加されたログエントリを抽出します。
- 開始時と停止時にログファイルのスナップショットを保存し、比較します。
- 比較はバイナリ比較を行い、新規追加されたログエントリを特定します。

## 2.2. ログエントリ出力機能

- 抽出したエビデンスは、`setting.ini`の`EvidenceSavePath`で指定されたパスを親フォルダとします。
- 親フォルダの直下に、監視開始時のタイムスタンプに基づいた`YYYYMMDD_hhmmss`形式の名称でフォルダ（以下、エビデンス保存フォルダ）を新規に作成します。
- エビデンス保存フォルダ内には、以下の3種類のフォルダ群を保存します。
  - **`snapshot1`フォルダ:** 監視開始時点のログファイルのスナップショットを格納します。
  - **`snapshot2`フォルダ:** 監視停止時点のログファイルのスナップショットを格納します。
  - **`evidence`フォルダ:** `snapshot1`と`snapshot2`を比較して抽出された、差分（新規追加）部分のログファイルを格納します。
- 各フォルダ（`snapshot1`, `snapshot2`, `evidence`）内には、`[Targets]`セクションで定義されたキー（例: `WebAppLog`）ごとにサブフォルダが作成され、その中に対象のログファイルが保存されます。
- 監視の結果、ログファイルに差分（新規追加）がなかった場合でも、`evidence`フォルダは作成されます（中身は空となります）。処理完了後、ユーザーには「差分はありませんでした。」という内容のダイアログを表示して通知します。

## 2.3. 異常系要件

アプリケーションの実行中に発生しうる主要なエラーケースと、その際の挙動を以下に定義します。エラー発生時は、原則としてユーザーにダイアログでエラー内容を通知し、処理を中断します。

- **設定ファイルエラー:**
  - `setting.ini` が存在しない場合: 「設定ファイルが見つかりません。」というメッセージを表示する。
  - `setting.ini` の必須項目 (`EvidenceSavePath` や `[Targets]` の定義) が不足している場合: 「設定ファイルの内容が不正です。」というメッセージを表示する。

- **ファイルシステムエラー:**
  - `EvidenceSavePath` で指定されたパスが存在しない場合: 「エビデンス保存先フォルダが存在しません。」というメッセージを表示する。
  - `EvidenceSavePath` への書き込み権限がない場合: 「エビデンス保存先フォルダに書き込みできません。」というメッセージを表示する。
  - 監視対象のログファイルの読み取りに失敗した場合: 「ログファイルの読み取りに失敗しました。」というメッセージを表示する。

# 3. 非機能要件

## 3.1. 性能

- 迅速なエビデンス収集と処理
- 大量のエビデンスデータに対応

## 3.2. セキュリティ

- エビデンスデータの保護
- アクセス制御

## 3.3. ユーザビリティ

- 直感的で分かりやすい UI
- 簡単な操作でエビデンスを収集・管理できること

# 4. アーキテクチャ

クリーンアーキテクチャに基づき、以下のレイヤーで構成します。

- **Presentation Layer (UI/Controller):** UI とユーザーからの入力を処理します。
- **Application Layer (Use Cases/Interactors):** アプリケーション固有のビジネスロジックを実装します。
- **Domain Layer (Entities/Value Objects):** コアビジネスルールとエンティティを定義します。
- **Infrastructure Layer (Gateways/Repositories):** データベース、ファイルシステム、外部サービスとの連携を扱います。

## 4.1. 技術スタック

- **言語:** C#
- **フレームワーク:** WPF (.NET Core)
- **アーキテクチャパターン:** MVVM

## 4.2. フォルダ構成

```txt
/ (ソリューションフォルダ)
│
├── EvidenceSupportTool/ (WPFアプリケーションプロジェクト)
│   ├── Models/         # データ構造を定義するクラス (M)
│   ├── ViewModels/     # UIのロジックと状態を持つクラス (VM)
│   ├── Views/          # XAMLで定義されたUI (V)
│   ├── Services/       # ビジネスロジックやデータアクセス
│   ├── Converters/     # データバインディング用のコンバータ
│   ├── Commands/       # ICommandの実装 (RelayCommandなど)
│   ├── Resources/      # 画像やスタイル、リソースディクショナリ
│   ├── App.xaml
│   └── MainWindow.xaml
│
├── EvidenceSupportTool.Tests/ (テストプロジェクト)
│   └── (ViewModelsやServicesのテストコード)
│
├── docs/             # ドキュメント
└── spec/             # 仕様書
    └── BaseDesign/   # 基本設計書
```

## 4.3. 設定ファイル (`setting.ini`)

アプリケーションの動作は `setting.ini` ファイルで設定します。ファイルは以下の形式で構成されます。

```ini
; エビデンスサポートツール 設定ファイル

[Targets]
; 監視対象となるログファイル/フォルダを定義します。
; ここで定義したキー（=の左側）が、エビデンス保存時のフォルダ名になります。
;
; パスには以下の特殊な日付・時刻フォーマットを使用できます。
;   *        : ファイル名のワイルドカード
;   {YYYY}   : 4桁の年 (例: 2025)
;   {MM}     : 2桁の月 (例: 10)
;   {DD}     : 2桁の日 (例: 16)
;
; 例:
; AppLog = C:\App\Logs\{YYYY}{MM}{DD}\application_*.log
; SystemLog = C:\Windows\System32\winevt\Logs\System.evtx

WebAppLog = D:\home\LogFiles\http\RawLogs\{YYYY}\{MM}\{DD}\*
DatabaseLog = D:\home\LogFiles\database\*.log


[Settings]
; ツールの動作全般に関する設定です。

; EvidenceSavePath: 抽出したエビデンスを保存する親フォルダのパス
EvidenceSavePath = C:\EvidenceOutput

; KeepSnapshot: 監視停止時に、比較元として使用したログのスナップショットを保持するかどうか
; true  = 保持する
; false = 削除する
KeepSnapshot = false
```

### `[Targets]` セクション

- **目的:** 監視対象のログファイルまたはフォルダを定義します。
- **書式:** `キー = 値`
  - `キー`: エビデンスの出力先フォルダ名として使用される任意の名前です。
  - `値`: 監視対象のファイルまたはフォルダのフルパスです。
- **特殊フォーマット:** パス文字列には、実行時の日付に基づいて動的にパスを解決するためのプレースホルダーを含めることができます。
  - `*`: ファイル名内の任意（0 文字以上）の文字列に一致するワイルドカードです。
  - `{YYYY}`: 実行時の西暦 4 桁の年（例: `2025`）に置換されます。
  - `{MM}`: 実行時の 2 桁の月（例: `01`, `12`）に置換されます。
  - `{DD}`: 実行時の 2 桁の日（例: `01`, `31`）に置換されます。

### `[Settings]` セクション

- **`EvidenceSavePath`**
  - **目的:** 抽出されたエビデンス（差分ログ）を保存するための親フォルダを指定します。
  - **詳細:** このパスの直下に `[Targets]` セクションで定義したキー名のフォルダが作成され、その中にログが保存されます。
- **`KeepSnapshot`**
  - **目的:** ログの差分を比較するために一時的に作成されるスナップショットファイルを、処理完了後に保持するかどうかを制御します。
  - **値:**
    - `true`: スナップショットを削除せず、保持します。（デバッグ用）
    - `false`: 処理完了後、スナップショットを自動的に削除します。（通常運用）

# 5. クラス図

クラス図は `spec/BaseDesign/ClassDesign/class_diagram.md` を参照してください。

# 6. 今後の開発計画

1. **設計フェーズ:**
   - 詳細な UI/UX 設計
   - 各機能のモジュール設計
2. **実装フェーズ:**
   - コア機能の実装
   - UI の実装
   - 単体テスト、結合テスト
3. **テストフェーズ:**
   - システムテスト
   - ユーザー受け入れテスト
4. **リリース:**
   - ドキュメント作成
   - デプロイ
